---
layout: post
title:  "[2019 학부 종합설계]임베디드 기반 하이퍼레저 패브릭을 활용한 출입관리시스템"
date:   2019-12-22
excerpt: "임베디드 기반 하이퍼레저 패브릭을 활용한 출입관리시스템"
project: true
tag:
- blockchain
- hyperledger
- Raspberry Pi
- Imbeded System
- NFC

comments: true
---


# 블록체인 기반 출입관리시스템

-  발주처 : 한국항공대
-  프로젝트 기간 : 2019.03~2019.12
- 역할
    - 팀 리더 수행하며 프로젝트의 기획, 개발 총괄
    - 하이퍼레저 패브릭 도커 컴포즈 구성 및 빌드
    - MSP를 통한 기관별 노드 권한부여
    - 출입이력 트랜잭션 체인코드 설계
    - dApp 설계 및 SDK를 활용한 체인코드 연동

- 개요
    - 배경
        - 현재 출입관리 시스템은 출입관리를 통제하는 Controller 비용과 출입이력 데이터 서버 비용이 상당함.
        - 또한 고객 개인정보유출에 대한 위험성 (*2p 기존 시스템/서비스 환경 문제점 참고)이 존재
        - 임베디드시스템 기반의 하이퍼레저 패브릭 블록체인을 활용한 출입관리시스템을 만들어 위와 같은 문제를 해결하고자 함
    - 장점
        - 중앙 서버 비용이 필요 없음
        - Controller가 서버로부터 데이터를 네트워크를 통해 전달받지 않고 직접 원장을 비교하므로 네트워크 비용 절감
        - 체인코드를 통해 블록체인 분산원장에 출입이력을 관리하므로 거래의 안전성과 데이터 무결성 보장
        - 출입이력 중 프라이버시에 민감한 내용은 DID를 활용해 암호화하여 저장하여 개인정보보호 보장


- 기존 시스템/서비스 환경 문제점
    - 전자 출입 관리 시스템에서 발생되는 서버비용과 유지보수 비용 및 컨트롤러 비용이 상당함
    - 기본 사양으로 출입시스템 한 대 구축시 월 50만원 정도의 비용 발생
    <img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/160284891-6ab05975-4cd1-4ac2-8bef-542ee8e4d05b.png">
    - 유명 건물 관리 및 출입 통제 시스템에서 개인정보에 관련된 취약점들이 발견되었으며, 이 취약점들을 익스플로잇 할 경우 단말기에 대한 접근 권한을 공격자가 가져가 데이터를 변조하고 고객 개인정보가 유출될 수 
    <img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/160284932-e31b27e1-3b19-4cee-95df-c073aeeb7f11.png">

- 현행 시스템/서비스 프로세스
    <img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/160285307-8e5dba6c-e603-49c2-bcb9-8585b9cda58b.png">

- 현행 시스템과 제안(블록체인 기반) 모델 비교

|구분|현행 수기 출입관리|현행 전자 출입관리 시스템|블록체인 기반 제안 모델|
|---- |---              |---|---|
|안전성|수기 위,변조(악의적인 오기입)가능|출입 담당자의 이중거래 발생 가능성|탈중앙화 데이터 보안 (기밀성, 무결성 보장)|
|투명,보안성|개인정보 탈취 문제 발생|개인정보 탈취 문제 발생|DID, Private State DB로 개인정보 탈취 문제 해결|
|경제성 및 효율성|수기 관리인 필요(인력낭비), 병목현상 (시간, 효율성 낭비)|서버, 컨트롤러 비용 발생|체인코드를 통한 출입 One-stop 방식 처리|


- 솔루션
    - 블록체인 플랫폼
    <img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/160285043-f3cc4bbc-aa87-4368-8dd4-c02e50c75baa.png">
    
    - 컨트롤러(라즈베리파이)와 데스크탑 모두 동등한 하나의 피어로서 출입 트랜잭션에 대한 검증 수행
    - 이 때, 서버 없이 모든 피어가 같은 분산원장을 공유하고 있기에 서버 비용 절감
    - 컨트롤러는 핵심적인 기능(트랜잭션 검증)만 수행하여 컨트롤러 비용을 절감
    - 블록 생성에 관여하여 컴퓨팅 연산 비용이 많은 노드는 성능이 좋은 데스크탑을 따로 둠으로서 비용절감 및 효율성 증대
    
    <img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/160285107-d3924d10-babf-4cc2-aa06-39ffa694eb29.png">
    - 출입관리가 필요한 기관들을 하나의 채널로 묶어서 One-Stop 방식으로 트랜잭션을 병렬처리함으로서 경제적인 효과 증대


- 프로세스
    <img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/160285164-6535d364-3fb8-48af-9cd1-c7287f566467.png">
    
- 기존 출입관리 시스템과 블록체인 모델의 비용 비교

|구분|엔로비 방문객 출입관리시스템|블록체인 기반 제안 모델|
|------|---|---|
|사용된 클라우드|KT G-클라우드|클라우드 사용 X (비용 견적은 클라우드를 사용했음을 가정 함)|
|비용 산출 기준|기본 월 이용 요금 = <span style="color:red">495,000 \(월)</span>|기본 네트워크 구성 MSP A(CA1, Orderer1, Peer1), MSP B(CA1, Peer1) + 컨소시엄 기관 추가(CA1, Peer2) = <span style="color:red">436,320 \(월)</span>|




<img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/159282661-f1210405-3026-4a13-a614-20ee6945c054.png">

- 문을 제어하는 라즈베리파이
- 관리자가 네트워크를 모니터링 할 수 있는 PC들로 구성
    - 네트워크는 하이퍼레저 패브릭 블록체인으로 구성
    - 각 라즈베리파이와 PC들은 하이퍼레저 패브릭을 구성하는 노드(Peer, Orderer)


## Getting started

> 임베디드 시스템과 블록체인을 활용하여 블록체인 모델을 만들 때 어떤 것이 좋을지 고민을 많이 하였습니다. <br>
가장 간단하게 실험할 수 있는 NFC 모듈과 라즈베리파이, 하이퍼레저 패브릭 블록체인을 결합하는 모델을 생각하다보니 **임베디드 기반의 출입관리시스템** 을 생각하게 되었습니다.
<br>[![Video Label](https://img.youtube.com/vi/ci2D25heTXE/0.jpg)](https://youtu.be/ci2D25heTXE) 


## Network Flow

<img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/159282677-5d1e6e8b-81ff-43f2-8a97-98a39551df3d.png">

- 라즈베리파이들과 데스크탑, 모두 동등한 하나의 피어로서 네트워크에 참여하고 있습니다.

- 모든 피어들은 모두 같은 분산원장을 공유하고 있습니다.



## Application Workflow

<img width="715" alt="contentMap" src="https://user-images.githubusercontent.com/45926066/159282682-fea83789-1300-4741-9333-a0c46a71873b.png">

1. 게이트에 출입하고 싶은 사용자는 NFC 카드키를 단말에 접촉시킵니다.

2. 인터럽트가 들어오면 NFC 프로그램은 문을 열어주고 블록체인 네트워크에 해당 출입 로그를 저장하려고 합니다.

3. 하지만, 이 태그키가 애초에 등록이 되지 않은 태그 키이거나, 또는 가입 후 탈퇴한 태그 키 일 수 있습니다. 이럴 경우 문을 열어주면 안되됩니다.

4. 따라서 첫번째로, 이 태그 키의 주인이 출입 가능한 인물인지 쿼리를 진행합니다.

5. 먼저,Wallet을 통한 검사로 해당 NFC 키가 우리가 알고있는 키인지 확인합니다. 만약, 전혀 엉뚱한 키라면 이곳에서 차단받습니다.

6. 그 다음, 사용자가 유효한지 검사합니다.

 - 분산원장에서 NFC 키를 통해 쿼리를 하여 확인하는 것입니다. 탈퇴 된 회원은 이곳에서 차단받습니다.

 - 이에 비해, 아무 이상이 없다면 해당 사용자는 출입이 가능하다는 뜻이므로 문을 열어주게 되고, 현재의 출입 로그를 블록체인에 넣을 준비를 하게 됩니다.




